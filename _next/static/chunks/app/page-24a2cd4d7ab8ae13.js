(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{4714:function(e,t,s){Promise.resolve().then(s.bind(s,4767))},4767:function(e,t,s){"use strict";s.d(t,{default:function(){return ew}});var l=s(7437),a=s(6648),n=s(2265),r=s(5236),i=s(5735),u=s(9842);let c=(0,r.C6)().length?(0,r.Mq)():(0,r.ZF)({apiKey:"AIzaSyD00lhuaPMM6Q4Gk8BORGQsrjXpnvf3V3A",authDomain:"nextjs-chat-84728.firebaseapp.com",projectId:"nextjs-chat-84728",storageBucket:"nextjs-chat-84728.appspot.com",messagingSenderId:"959601965223",appId:"1:959601965223:web:1fe6fec97df7e5672f8382",measurementId:"G-YT22RTTE12"}),d=(0,u.ad)(c),o=(0,i.v0)(c),D=new i.hJ,x=(0,u.hJ)(d,"user"),f=(0,u.hJ)(d,"online");async function h(){try{let e=(await (0,i.rh)(o,D)).user,t=(0,u.JU)(x,e.uid),s=(0,u.JU)(f,e.uid);(await (0,u.QT)(t)).exists()||(await (0,u.pl)(t,{name:e.displayName,tag:e.email,email:e.email,photoURL:e.photoURL,uid:e.uid,friends:{},status_msg:"아직 상태 메시지가 없습니다."}),await (0,u.pl)(s,{uid:e.uid,target:null}))}catch(e){console.error("Error signing in with Google",e)}}async function m(){try{return o.signOut()}catch(e){console.error("Error signing out with Google",e)}}let g=(0,u.hJ)(d,"online");async function j(e){let{uid:t,tuid:s}=e;try{let e=(0,u.JU)(g,s),l=(await (0,u.QT)(e)).data();if((null==l?void 0:l.target)===t)return!0;return!1}catch(e){console.error("isOnlineOnChatRoom [ERROR]: ",e)}}let p=(0,u.hJ)(d,"user"),v=(0,u.hJ)(d,"chat"),E=(0,u.hJ)(d,"online");async function w(e){let{host:t}=e;try{let e=(0,u.JU)(E,t);(0,u.r7)(e,{target:null})}catch(e){console.error(e)}}async function y(e){let{host:t,target:s}=e;try{let e=(0,u.JU)(E,t);(0,u.r7)(e,{target:s})}catch(e){console.error(e)}}async function N(e,t){let{host:s,target:l,chat_id:a}=e;try{y({host:s,target:l});let e=(0,u.IO)(v,(0,u.ar)("host","in",[s,l]),(0,u.ar)("target","in",[s,l])),n=await (0,u.PL)(e),r=(0,u.JU)(v,a),i=n.docs[0].data().chat,c=Object.values(i).map(e=>(e.sender!==s&&(e.read=!0),e)),d=(0,u.JU)(p,s),o=(await (0,u.QT)(d)).data(),D={...null==o?void 0:o.friends[l],unReadMsg:0};return await (0,u.r7)(d,{["friends.".concat(l)]:D}),await (0,u.r7)(r,{chat:c}),(0,u.cf)(r,e=>{e.exists()&&t({chat_id:a,chat:e.data()})})}catch(e){return console.error(e),t({})}}async function b(e){let{uid:t,tuid:s,chatID:l,message:a}=e;try{var n;let e=await j({uid:t,tuid:s}),r=(0,u.JU)(v,l),i=(await (0,u.QT)(r)).data(),c=(0,u.JU)(p,t),d=(await (0,u.QT)(c)).data(),o=(0,u.JU)(p,s),D=(await (0,u.QT)(o)).data(),x=[{sender:t,message:a,timestamp:new Date,read:e},...null==i?void 0:i.chat];await (0,u.r7)(r,{chat:x});let f={...null==d?void 0:d.friends[s],latestMsg:a,lastMsgAt:new Date},h={...null==D?void 0:D.friends[t],latestMsg:a,lastMsgAt:new Date,unReadMsg:e?0:(null==D?void 0:null===(n=D.friends[t])||void 0===n?void 0:n.unReadMsg)+1};await (0,u.r7)(c,{["friends.".concat(s)]:f}),await (0,u.r7)(o,{["friends.".concat(t)]:h}),console.log("채팅 데이터가 성공적으로 저장되었습니다.")}catch(e){console.error(e)}}let C=async()=>{await h()},R=e=>{w({host:e}).then(()=>{m()})},M=()=>{let[e,t]=(0,n.useState)(null);return(0,n.useEffect)(()=>{let e=o.onAuthStateChanged(async e=>{e?t(e):t(null)});return()=>e()},[]),e},k=e=>{(0,n.useEffect)(()=>{if(!e)return;let t=t=>{w({host:e}).then(()=>{console.log("사용자 로그아웃")}).catch(e=>{console.error("beforeUnload 에러: ",e)}),t.preventDefault(),t.returnValue=""};return window.addEventListener("beforeunload",t),()=>{window.removeEventListener("beforeunload",t)}},[e])},S=(0,u.hJ)(d,"user"),A=(0,u.hJ)(d,"chat");async function F(e){try{var t;let s=(0,u.JU)(S,null===(t=o.currentUser)||void 0===t?void 0:t.uid);return(0,u.cf)(s,t=>{t.exists()&&e(t.data())})}catch(e){console.error("user.ts, getUser() ERR: ",e)}}async function T(e){let{uid:t}=e;try{let e=(0,u.JU)(S,t),s=await (0,u.QT)(e);if(s.exists())return s.data();return null}catch(e){return console.error("user.ts, getUserByUid() ERR: ",e),null}}async function _(e){let{uid:t,target:s}=e;try{var l;let[e,a]=s,n=(0,u.IO)(S,(0,u.ar)("name","==",e),(0,u.ar)("tag","==",a)),r=await (0,u.PL)(n),i=null===(l=r.docs[0])||void 0===l?void 0:l.id;if(0===r.size)return{status:!1,msg:"ERR_NOT_USER"};if(t===i)return{status:!1,msg:"ERR_SELF"};let c=(0,u.JU)(S,t),d=(await (0,u.QT)(c)).data(),o=null==d?void 0:d.friends;if(o&&o[i]&&!o[i].isAccept)return{status:!1,msg:"ERR_ALREADY_REQ"};if(o&&o[i]&&o[i].isAccept)return{status:!1,msg:"ERR_ALREADY_FRIENDS"};return{target:r.docs[0].data(),status:!0,msg:"SUC_FIND"}}catch(e){console.error(e)}}async function L(e){let{uid:t,tuid:s}=e;try{let e=(0,u.JU)(S,t),l=(await (0,u.QT)(e)).data(),a=(0,u.JU)(S,s),n=(await (0,u.QT)(a)).data(),r=null==l?void 0:l.friends,i=null==n?void 0:n.friends,c=(null==l?void 0:l.name)+"님이 친구 요청을 보냈습니다.",d=await j({uid:t,tuid:s});return await (0,u.ET)(A,{host:t,target:s,isAccept:!1,chat:[{sender:t,message:c,timestamp:new Date,read:d}]}).then(async l=>{let n={...r,[s]:{uid:s,isAccept:!1,isHost:!1,unReadMsg:0,latestMsg:c,lastMsgAt:new Date,chat_id:l.id}},d={...i,[t]:{uid:t,isAccept:!1,isHost:!0,unReadMsg:1,latestMsg:c,lastMsgAt:new Date,chat_id:l.id}};await (0,u.r7)(e,{friends:n}),await (0,u.r7)(a,{friends:d}),await (0,u.r7)(l,{chat_id:l.id})}),!0}catch(e){return console.error(e),!1}}async function U(e){let{uid:t,tuid:s,chatID:l}=e;try{let e=(0,u.JU)(S,t),a=(await (0,u.QT)(e)).data(),n=(0,u.JU)(S,s),r=(await (0,u.QT)(n)).data(),i=(0,u.JU)(A,l),c=(await (0,u.QT)(i)).data(),d=(null==a?void 0:a.name)+"님이 친구 요청을 수락했습니다.",o=await j({uid:t,tuid:s}),D=[{sender:t,message:null,timestamp:new Date,read:null},{sender:t,message:d,timestamp:new Date,read:o},...null==c?void 0:c.chat];await (0,u.r7)(i,{isAccept:!0,chat:D});let x={...null==a?void 0:a.friends,[s]:{...null==a?void 0:a.friends[s],isAccept:!0,latestMsg:d,lastMsgAt:new Date}};await (0,u.r7)(e,{friends:x});let f={...null==r?void 0:r.friends,[t]:{...null==r?void 0:r.friends[t],isAccept:!0,latestMsg:d,lastMsgAt:new Date,unReadMsg:o?0:1}};return await (0,u.r7)(n,{friends:f}),{friends:f,name:null==r?void 0:r.name,tag:null==r?void 0:r.tag}}catch(e){console.error(e)}}async function H(e,t){let{uid:s}=e;try{let e=(0,u.JU)(S,s);return(0,u.cf)(e,async e=>{if(e.exists()){let s=e.data();if(s&&s.friends){let e=Object.values(s.friends).map(e=>T({uid:e.uid})),l=(await Promise.all(e)).filter(e=>null!==e).sort((e,t)=>{let s=new Date(null==e?void 0:e.lastMsgAt);return new Date(null==t?void 0:t.lastMsgAt).getTime()-s.getTime()});t(l)}else t([])}else t([])})}catch(e){return console.error("user.ts, getFriends() ERR: ",e)}}async function J(e){try{console.log(e);let t=(0,u.JU)(S,e.uid);return await (0,u.r7)(t,e),!0}catch(e){return console.error("user.ts, saveProfile() ERR: ",e),null}}async function q(e){let{name:t,tag:s}=e;try{let e=(0,u.IO)(S,(0,u.ar)("name","==",t),(0,u.ar)("tag","==",s)),l=await (0,u.PL)(e);if(0===l.size)return!1;return!0}catch(e){return console.error(e),!0}}var B=s(4839),z=s(6164);let Q=function(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,z.m6)((0,B.W)(t))},I=e=>{switch(e){case"ERR_NOT_USER":return{status:!1,msg:"그런 사람은 없습니다."};case"ERR_ALREADY_REQ":return{status:!1,msg:"이미 친구요청을 보냈습니다. 기다려보세요."};case"ERR_ALREADY_FRIENDS":return{status:!1,msg:"두 분은 이미 친구네요."};case"ERR_SELF":return{status:!1,msg:"자기 자신에게 친구 요청을 보내셨나요...?"};case"SUC_FIND":return{status:!0,msg:"suc"};default:return{status:!1,msg:"ERROR"}}},P=e=>{let{w:t,h:s}=e;return(0,l.jsx)(a.default,{src:"/emoji/Astronaut.png",alt:"Astronaut",width:t||256,height:s||256})},O=e=>{let{w:t,h:s}=e;return(0,l.jsx)(a.default,{src:"/emoji/Man Bouncing Ball Dark Skin Tone.png",alt:"Man Bouncing Ball Dark Skin Tone",width:t||256,height:s||256})},V=e=>{let{w:t,h:s}=e;return(0,l.jsx)(a.default,{src:"/emoji/Woman Gesturing No Medium-Light Skin Tone.png",alt:"Woman Gesturing No Medium-Light Skin Tone",width:t||256,height:s||256})},W=e=>{let{w:t,h:s}=e;return(0,l.jsx)(a.default,{src:"/emoji.Clapping Hands Light Skin Tone.png",alt:"Clapping Hands Light Skin Tone",width:t||256,height:s||256})},G=e=>{let{w:t,h:s}=e;return(0,l.jsx)(a.default,{src:"/emoji/Waving Hand Medium-Light Skin Tone.png",alt:"Waving Hand Medium-Light Skin Tone",width:t||256,height:s||256})},Y=e=>{let{w:t,h:s}=e;return(0,l.jsx)(a.default,{src:"/emoji/Folded Hands Light Skin Tone.png",alt:"Folded Hands Light Skin Tone",width:t||256,height:s||256})},K=e=>{let{w:t,h:s}=e;return(0,l.jsx)(a.default,{src:"/emoji/Love Letter.png",alt:"Love Letter",width:t||256,height:s||256})};function $(){return(0,l.jsxs)("div",{className:"w-screen h-screen flex flex-col justify-center items-center",children:[(0,l.jsx)("p",{className:"text-3xl mb-4 animate-fade-in-up",children:"지금 로딩중이에요."}),(0,l.jsx)("p",{className:"text-lg animate-fade-in-up",children:"접속이 안되고, 이 화면이 계속 나오나요?"}),(0,l.jsx)("p",{className:"text-lg animate-fade-in-up",children:"그럼 뭔가 잘못된거같아요 ^_^"})]})}function X(){return(0,l.jsx)("div",{className:"w-full h-full flex flex-wrap justify-center items-center ",children:(0,l.jsx)("p",{children:"친구 목록 불러오는 중..."})})}function Z(){return(0,l.jsxs)("div",{className:"w-full h-full flex flex-col justify-center items-center",children:[(0,l.jsx)(O,{}),(0,l.jsx)("p",{className:"text-3xl mb-4 animate-fade-in-up",children:"채팅 데이터를 가져올게요."}),(0,l.jsx)("p",{className:"text-lg animate-fade-in-up",children:"서두르고 있어요, 잠시면 돼요."})]})}function ee(e){let{color:t}=e;switch(t){case"blue":default:return{bg:"bg-blue-500",bgd:"hover:bg-blue-600"};case"red":return{bg:"bg-red-500",bgd:"hover:bg-red-600"};case"green":return{bg:"bg-green-500",bgd:"hover:bg-green-600"};case"gray":return{bg:"bg-gray-500",bgd:"hover:bg-gray-600"}}}let et=e=>{let{className:t,children:s,color:a}=e,n=ee({color:a||"blue"});return(0,l.jsx)("div",{className:Q("w-fit min-w-5 h-5 flex items-center justify-center rounded-full text-white text-xs",t,n.bg),children:(0,l.jsx)("p",{className:"w-fit h-fit p-1",children:s})})},es=e=>{let{className:t,children:s,color:a,onClick:n}=e,r=ee({color:a||"blue"});return(0,l.jsx)("button",{className:Q("px-6 py-3 rounded-xl transition text-white",t,r.bg,r.bgd),onClick:()=>{n&&n()},children:s})},el=e=>{let{className:t,children:s,color:a,onClick:n}=e,r=ee({color:a||"blue"});return(0,l.jsx)("button",{className:Q("px-3 py-1 rounded-full transition text-white text-sm",t,r.bg,r.bgd),onClick:()=>{n&&n()},children:s})},ea=e=>{let{className:t,children:s,onClick:a}=e;return(0,l.jsxs)("div",{className:"fixed top-0 left-0 w-full h-full flex items-center justify-center z-50",children:[(0,l.jsx)("div",{className:"absolute w-full h-full bg-gray-500 opacity-50"}),(0,l.jsxs)("div",{className:Q("relative bg-white rounded-lg shadow-md w-96",t),children:[(0,l.jsx)("div",{className:"p-6",children:s}),a&&(0,l.jsx)("button",{className:"absolute top-2 right-2 text-gray-500",onClick:()=>{a()},children:(0,l.jsx)("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]})]})},en=e=>{let{friends:t}=e,[s,a]=(0,n.useState)(!1),[r,i]=(0,n.useState)(null),u=()=>{a(!1),i(null)},c=async()=>{let e=await t.friends.findHandler();e?i(e):a(!1)};return{show:s,setShow:a,modal:(0,l.jsx)(ea,{className:"w-full bg-white rounded-xl shadow-xl mx-2",onClick:()=>{u()},children:(0,l.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,l.jsx)("p",{className:"text-xl font-semibold",children:"친구 검색"}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"text-gray-500 text-sm pl-1 pb-1",children:"이름"}),(0,l.jsx)("input",{type:"text",placeholder:"이름을 입력하세요.",value:t.friends.findName||"",className:"w-full px-3 py-2 border rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 transition text-sm",onChange:e=>{t.friends.setFindName(e.target.value)}})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"text-gray-500 text-sm pl-1 pb-1",children:"태그"}),(0,l.jsx)("input",{type:"text",placeholder:"태그를 입력하세요.",value:t.friends.findTag||"",className:"w-full px-3 py-2 border rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 transition text-sm",onChange:e=>{t.friends.setFindTag(e.target.value)}})]}),(0,l.jsx)("p",{className:"text-red-500 font-semibold",children:r}),(0,l.jsx)(es,{onClick:()=>{c()},children:"검색"})]})})}},er=e=>{let{targetName:t,close:s,isMobile:a}=e,[n,r]=t;return(0,l.jsx)(ea,{className:"bg-white rounded-xl shadow-xl ".concat(a?"w-full p-2 mx-4":"w-1/2 p-6","   "),children:(0,l.jsxs)("div",{className:"flex flex-col justify-center items-center gap-4",children:[(0,l.jsx)(W,{w:a?128:void 0,h:a?128:void 0}),(0,l.jsx)("p",{className:"font-semibold ".concat(a?"text-lg":"text-2xl"),children:"새로운 친구가 생겼어요!"}),(0,l.jsxs)("p",{className:"text-gray-500 text-center break-keep ".concat(a?"text-sm":"text-lg"),children:["이제 ",(0,l.jsx)("span",{className:"text-black font-semibold",children:n}),(0,l.jsxs)("span",{className:"font-semibold",children:["#",r]}),"님과 대화할 수 있어요."]}),(0,l.jsx)(es,{onClick:()=>{s()},children:"좋아요"})]})})},ei=e=>{var t;let{targetData:s,reqSuc:r,requestHandler:i,close:u,isMobile:c}=e,[d,o]=(0,n.useState)(!0),D=()=>(o(!1),i());return(0,l.jsx)(ea,{className:"bg-white rounded-xl shadow-xl ".concat(c?"w-full mx-2":"w-1/2  p-6"),children:r?(0,l.jsxs)("div",{className:"flex flex-col justify-center items-center gap-4",children:[(0,l.jsx)(W,{}),(0,l.jsx)("p",{className:"text-2xl font-semibold",children:"친구요청을 보냈어요!"}),(0,l.jsx)("p",{className:"text-lg text-gray-500",children:"상대방이 수락하면 대화를 시작할 수 있어요."}),(0,l.jsx)(es,{onClick:()=>{u()},children:"알겠어요"})]}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{className:"border-b mb-4 pb-2",children:(0,l.jsx)("p",{className:"font-semibold text-gray-800 ".concat(c?"text-lg":"text-2xl  "),children:"찾으시는 사람이 맞나요?"})}),(0,l.jsxs)("div",{className:"w-full flex flex-col justify-center items-center gap-4 truncate mb-4 pb-2",children:[(0,l.jsx)("div",{className:"flex justify-center items-center rounded-full overflow-hidden border-4 border-gray-200 shadow-md",children:(0,l.jsx)(a.default,{src:null!==(t=s.photoURL)&&void 0!==t?t:"/user.png",width:80,height:80,alt:"user_icon",className:"object-cover"})}),(0,l.jsxs)("div",{className:"flex flex-col items-center",children:[(0,l.jsx)("p",{className:"text-xl font-medium text-gray-900",children:s.name}),(0,l.jsxs)("p",{className:"text-xl text-gray-500",children:["#",s.tag]})]}),(0,l.jsx)("p",{className:"w-full text-center text-gray-700 truncate",children:s.status_msg})]}),(0,l.jsxs)("div",{className:"flex justify-center items-center gap-6 border-t mb-4 pt-2",children:[(0,l.jsx)(es,{className:"".concat(d?"":"pointer-events-none"),onClick:()=>{D()},children:"네, 맞아요"}),(0,l.jsx)(es,{color:"gray",onClick:()=>{u()},children:"아니에요"})]})]})})},eu=e=>{let{user:t,close:s}=e,[r,i]=(0,n.useState)(t),[u,c]=(0,n.useState)(r.name),[d,o]=(0,n.useState)(r.tag),[D,x]=(0,n.useState)(r.status_msg),f=async()=>{if((r.name!==u||r.tag!==d)&&await q({name:u,tag:d}))return alert("그 이름은 누가 사용중이네요..? 태그를 다른걸로 적어봐요.");{let e={...r,name:u,tag:d,status_msg:D};await J(e)&&alert("변경된 정보로 프로필을 저장했습니다."),s()}},h=e=>{let{text:t}=e;return t.replace(/[`~!@#$%^&*()_|+\-=?;:'",.<>\{\}\[\]\\\/]/gim,"")};return(0,l.jsxs)(ea,{onClick:s,className:"rounded-xl",children:[(0,l.jsx)("div",{className:"border-b mb-4",children:(0,l.jsx)("p",{className:"text-xl",children:"프로필 수정"})}),(0,l.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,l.jsx)("div",{className:"w-20 h-20 flex justify-center items-center rounded-full overflow-hidden border",children:(0,l.jsx)(a.default,{src:r.photoURL||"",width:80,height:80,alt:"프로필 사진"})}),(0,l.jsxs)("div",{className:"flex flex-col items-start w-full gap-1",children:[(0,l.jsx)("label",{htmlFor:"name",children:"이름"}),(0,l.jsx)("input",{id:"name",type:"text",value:u,onChange:e=>c(h({text:e.target.value})),className:"w-full border rounded-md px-3 py-2"})]}),(0,l.jsxs)("div",{className:"flex flex-col items-start w-full gap-1",children:[(0,l.jsx)("label",{htmlFor:"tag",children:"태그"}),(0,l.jsx)("input",{id:"tag",type:"text",value:d,onChange:e=>o(h({text:e.target.value})),className:"w-full border rounded-md px-3 py-2"})]}),(0,l.jsxs)("div",{className:"flex flex-col items-start w-full gap-1",children:[(0,l.jsx)("label",{htmlFor:"statusMsg",children:"상태메시지"}),(0,l.jsx)("input",{id:"statusMsg",type:"text",value:D,onChange:e=>x(e.target.value),className:"w-full border rounded-md px-3 py-2"})]})]}),(0,l.jsx)("div",{className:"mt-8",children:(0,l.jsx)(es,{className:"w-full",onClick:f,children:"저장"})})]})},ec=e=>{let{onClick:t,isMobile:s}=e,a=Array.from("\uD83D\uDE00\uD83D\uDE03\uD83D\uDE04\uD83D\uDE01\uD83D\uDE06\uD83D\uDE05\uD83E\uDD23\uD83D\uDE02\uD83D\uDE42\uD83D\uDE43\uD83E\uDEE0\uD83D\uDE09\uD83D\uDE0A\uD83D\uDE07\uD83E\uDD70\uD83D\uDE0D\uD83E\uDD29\uD83D\uDE18\uD83D\uDE17\uD83D\uDE1A\uD83D\uDE19\uD83E\uDD72\uD83D\uDE0B\uD83D\uDE1B\uD83D\uDE1C\uD83E\uDD2A\uD83D\uDE1D\uD83E\uDD11\uD83E\uDD17\uD83E\uDD2D\uD83E\uDEE2\uD83E\uDEE3\uD83E\uDD2B\uD83E\uDD14\uD83E\uDEE1\uD83E\uDD10\uD83E\uDD28\uD83D\uDE10\uD83D\uDE11\uD83D\uDE36\uD83D\uDE12\uD83D\uDE44\uD83D\uDE2C\uD83D\uDE2E\uD83E\uDD25\uD83E\uDEE8\uD83D\uDE0C\uD83D\uDE14\uD83D\uDE2A\uD83E\uDD24\uD83D\uDE34\uD83D\uDE37\uD83E\uDD12\uD83E\uDD15\uD83E\uDD22\uD83E\uDD2E\uD83E\uDD27\uD83E\uDD75\uD83E\uDD76\uD83E\uDD74\uD83D\uDE35\uD83D\uDE35\uD83E\uDD2F\uD83E\uDD20\uD83E\uDD73\uD83E\uDD78\uD83D\uDE0E\uD83E\uDD13\uD83E\uDDD0\uD83D\uDE15\uD83E\uDEE4\uD83D\uDE1F\uD83D\uDE41\uD83D\uDE2E\uD83D\uDE2F\uD83D\uDE32\uD83D\uDE33\uD83E\uDD7A\uD83E\uDD79\uD83D\uDE26\uD83D\uDE27\uD83D\uDE28\uD83D\uDE30\uD83D\uDE25\uD83D\uDE22\uD83D\uDE2D\uD83D\uDE31\uD83D\uDE16\uD83D\uDE23\uD83D\uDE1E\uD83D\uDE13\uD83D\uDE29\uD83D\uDE2B\uD83E\uDD71\uD83D\uDE24\uD83D\uDE21\uD83D\uDE20\uD83E\uDD2C\uD83D\uDE08\uD83D\uDC7F\uD83D\uDC80\uD83D\uDCA9\uD83E\uDD21\uD83D\uDC79\uD83D\uDC7A\uD83D\uDC7B\uD83D\uDC7D\uD83D\uDC7E\uD83E\uDD16\uD83D\uDE3A\uD83D\uDE38\uD83D\uDE39\uD83D\uDE3B\uD83D\uDE3C\uD83D\uDE3D\uD83D\uDE40\uD83D\uDE3F\uD83D\uDE3E\uD83D\uDE48\uD83D\uDE49\uD83D\uDE4A\uD83D\uDC8B\uD83D\uDCAF\uD83D\uDCA2\uD83D\uDCA5\uD83D\uDCAB\uD83D\uDCA6\uD83D\uDC4B\uD83E\uDEF1\uD83E\uDEF2\uD83E\uDEF3\uD83E\uDEF4\uD83E\uDEF7\uD83E\uDEF8\uD83D\uDC4C\uD83E\uDD0C\uD83E\uDD0F\uD83E\uDD1E\uD83E\uDEF0\uD83E\uDD1F\uD83E\uDD18\uD83E\uDD19\uD83D\uDC48\uD83D\uDC49\uD83D\uDC46\uD83D\uDD95\uD83D\uDC47\uD83E\uDEF5\uD83D\uDC4D\uD83D\uDC4E✊\uD83D\uDC4A\uD83E\uDD1B\uD83E\uDD1C\uD83D\uDC4F\uD83D\uDE4C\uD83E\uDEF6\uD83D\uDC50\uD83E\uDD32\uD83E\uDD1D\uD83D\uDE4F✍️\uD83D\uDC85\uD83E\uDD33\uD83D\uDCAA\uD83E\uDDBE\uD83E\uDDBF\uD83E\uDDB5\uD83E\uDDB6\uD83D\uDC42\uD83E\uDDBB\uD83D\uDC43\uD83E\uDDE0\uD83E\uDEC0\uD83E\uDEC1\uD83E\uDDB7\uD83E\uDDB4\uD83D\uDC40\uD83D\uDC45\uD83D\uDC44\uD83E\uDEE6\uD83D\uDC8C\uD83D\uDC98\uD83D\uDC9D\uD83D\uDC96\uD83D\uDC97\uD83D\uDC93\uD83D\uDC9E\uD83D\uDC95\uD83D\uDC9F\uD83D\uDC94\uD83E\uDE77\uD83E\uDDE1\uD83D\uDC9B\uD83D\uDC9A\uD83D\uDC99\uD83E\uDE75\uD83D\uDC9C\uD83E\uDD0E\uD83D\uDDA4\uD83E\uDE76\uD83E\uDD0D");return(0,l.jsxs)("div",{className:"absolute bottom-0 right-0  p-4 ".concat(s?"w-72 h-24 -translate-y-12":"w-96 h-48 -translate-y-8"),children:[(0,l.jsx)("div",{className:"z-10 w-full h-full overflow-y-scroll",children:(0,l.jsx)("div",{className:"w-full h-full flex flex-wrap justify-center items-center gap-4",children:a.map((e,s)=>(0,l.jsx)("p",{className:"cursor-pointer",onClick:()=>t(e),children:e},s))})}),(0,l.jsx)("div",{className:"-z-10 absolute bottom-0 right-0 w-full h-full bg-slate-200 rounded-xl opacity-80"})]})},ed=e=>{let{onClick:t}=e;return(0,l.jsx)("div",{className:" flex justify-center items-center mb-4",children:(0,l.jsxs)("div",{className:"relative flex flex-col justify-center items-center gap-4 p-4 rounded-xl shadow-lg overflow-hidden",children:[(0,l.jsx)("div",{className:"z-10 absolute top-0 left-0 w-full h-full bg-slate-100 opacity-50"}),(0,l.jsxs)("div",{className:"z-20 flex flex-col justify-center items-center",children:[(0,l.jsx)(G,{}),(0,l.jsx)("p",{className:"font-semibold",children:"친구 요청이 도착했어요!"}),(0,l.jsx)(es,{onClick:t,children:"수락하기"})]})]})})},eo=()=>(0,l.jsx)("div",{className:" flex justify-center items-center mb-4",children:(0,l.jsxs)("div",{className:"relative flex flex-col justify-center items-center gap-4 p-4 rounded-xl shadow-lg overflow-hidden",children:[(0,l.jsx)("div",{className:"z-10 absolute top-0 left-0 w-full h-full bg-slate-100 opacity-50"}),(0,l.jsxs)("div",{className:"z-20 flex flex-col justify-center items-center",children:[(0,l.jsx)(Y,{}),(0,l.jsx)("p",{className:"font-semibold",children:"친구가 생겼네요!"}),(0,l.jsx)("p",{className:"text-blue-500 ",children:"이제 채팅할 수 있어요."})]})]})});function eD(e){var t;let{userData:s,isLogin:a,logout:n,chat:r,friends:i,icon:u}=e,c=s.user,d=en({friends:{friends:i}}),o=e=>{let{isHost:t,target_uid:l}=e;t||null===l?s.setModalEditProfile(!s.modalEditProfile):null==r||r.targetHandler(l)};return r.target?(0,l.jsx)(ex,{user:c,chat:r,icon:u}):(0,l.jsxs)("main",{className:"w-screen min-h-screen flex flex-col justify-start items-center px-3 py-6",children:[d.show?null==d?void 0:d.modal:null,i.findModal&&(0,l.jsx)(ei,{targetData:i.targetData,reqSuc:i.reqSuc,requestHandler:i.requestHandler,close:i.findModalHandler,isMobile:!0}),s.modalEditProfile?(0,l.jsx)(eu,{user:c,close:()=>{s.setModalEditProfile(!s.modalEditProfile)}}):null,(0,l.jsxs)("div",{className:"w-full flex justify-between items-center mb-4",children:[(0,l.jsx)("p",{className:"text-2xl font-semibold",children:"채팅"}),(0,l.jsxs)("div",{className:"flex gap-3",children:[(0,l.jsxs)(el,{className:"flex justify-center items-center gap-2",onClick:()=>{null==d||d.setShow(!0)},children:[(0,l.jsx)(u.VscSearch,{size:20}),(0,l.jsx)("p",{children:"검색"})]}),(0,l.jsxs)(el,{className:"flex justify-center items-center gap-2",color:"gray",onClick:n,children:[(0,l.jsx)(u.VscUnlock,{size:20}),(0,l.jsx)("p",{children:"로그아웃"})]})]})]}),(0,l.jsx)("label",{className:"w-full text-xs text-gray-600 mb-2",children:"나"}),(0,l.jsx)(ef,{host:c,user:c,isHost:!0,onClick:()=>{o({isHost:!0,target_uid:null})}}),(0,l.jsx)("div",{className:"w-full border-b my-4"}),(0,l.jsx)("label",{className:"w-full text-xs text-gray-600 mb-2",children:"친구"}),(0,l.jsx)("div",{className:"w-full flex flex-col gap-2",children:null===(t=i.friends)||void 0===t?void 0:t.map((e,t)=>(0,l.jsx)(ef,{host:c,user:e,isHost:!1,onClick:()=>{o({isHost:!1,target_uid:e.uid})}},t))})]})}let ex=e=>{let{user:t,chat:s,icon:n}=e,r=()=>s.initChat();return s.chatData?(0,l.jsxs)("main",{className:"w-screen h-screen max-h-screen flex flex-col justify-start items-center px-3 py-6",children:[s.acceptFriendReq&&s.acceptFriendReqTargetName&&(0,l.jsx)(er,{targetName:s.acceptFriendReqTargetName,close:s.acceptFriendReqModalHandler,isMobile:!0}),(0,l.jsxs)("div",{className:"w-full flex justify-start items-center gap-4 border-b pb-2",children:[(0,l.jsxs)("div",{className:"flex justify-center items-center",children:[(0,l.jsx)(n.VscChevronLeft,{size:40,onClick:()=>{r()}}),(0,l.jsx)("div",{className:"flex justify-center items-center rounded-full overflow-hidden border",children:(0,l.jsx)(a.default,{src:s.target.photoURL||"/user.png",width:60,height:60,alt:"user_icon"})})]}),(0,l.jsxs)("div",{className:"w-full flex flex-col items-start",children:[(0,l.jsxs)("p",{className:"text-xl font-semibold",children:[s.target.name," "]}),(0,l.jsx)("p",{className:"text-xs text-gray-500 w-full truncate",children:s.target.status_msg})]})]}),(0,l.jsx)("div",{className:"w-full h-screen flex flex-col-reverse gap-4 overflow-y-auto py-2",children:Array.isArray(s.chatData.chat)&&s.chatData.chat.map((e,n)=>{if(!e.sender)return(0,l.jsx)(eo,{},n);var r=e.timestamp.toDate().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});return e.message&&(0,l.jsxs)("div",{children:[e.showDate&&(0,l.jsxs)("div",{className:"relative w-full flex justify-center items-center my-4",children:[(0,l.jsx)("div",{className:"absolute top-1/2 left-0 w-full border"}),(0,l.jsx)("div",{className:"text-gray-500 text-sm bg-white z-30 px-4",children:e.showDate})]}),t.uid===e.sender?(0,l.jsxs)("div",{className:"flex justify-end gap-2 items-end",children:[(0,l.jsxs)("div",{className:"flex flex-col items-end text-blue-300",children:[(0,l.jsx)("p",{className:"text-xs",children:e.read?"":"1"}),(0,l.jsx)("p",{className:"text-xs text-gray-400",children:e.showTime&&r})]}),(0,l.jsx)("div",{className:"max-w-72 bg-blue-500 p-3 text-sm rounded-tl-xl rounded-tr-xl rounded-bl-xl break-all text-white",children:(0,l.jsx)("p",{children:e.message})}),(0,l.jsx)("div",{className:"flex justify-center items-center rounded-full overflow-hidden border",children:(0,l.jsx)(a.default,{src:t.photoURL||"/user.png",width:30,height:30,alt:"user_icon"})})]}):(0,l.jsxs)("div",{className:"flex gap-2 justify-start items-end",children:[(0,l.jsx)("div",{className:"flex justify-center items-center rounded-full overflow-hidden border",children:(0,l.jsx)(a.default,{src:s.target.photoURL||"/user.png",width:30,height:30,alt:"user_icon"})}),(0,l.jsx)("div",{className:"max-w-72 bg-slate-100 p-3 text-sm rounded-tr-xl rounded-tl-xl rounded-br-xl break-all",children:(0,l.jsx)("p",{children:e.message})}),(0,l.jsx)("p",{className:"text-xs text-gray-400",children:e.showTime&&r})]})]},n)})}),!s.chatData.isAccept&&t.uid===s.chatData.target&&(0,l.jsx)(ed,{onClick:()=>s.acceptReqHandler({uuid:t.uid,tuid:s.target.uid,chatID:s.chatID})}),(0,l.jsx)("div",{className:"w-full flex justify-center items-center pt-2 h-fit ".concat(s.chatData.isAccept?"":"pointer-events-none"),children:(0,l.jsxs)("div",{className:"w-full h-fit flex justify-between items-center gap-2 rounded-full bg-slate-100 px-4 py-2",children:[(0,l.jsx)("input",{type:"text",placeholder:s.chatData.isAccept?"채팅을 입력하세요":"친구가 되기 전에 채팅을 보낼 수 없어요.",value:s.msg||"",onChange:e=>{s.setMsg(e.target.value)},onKeyDown:e=>{"Enter"===e.key&&s.sendMsg()},className:"bg-transparent outline-none w-10/12"}),(0,l.jsxs)("div",{className:"relative flex justify-end items-center w-1/12",children:[s.displayEmoji&&(0,l.jsx)(ec,{isMobile:!0,onClick:e=>s.inputEmoji({emoji:e,setMsg:s.setMsg})}),(0,l.jsx)(n.VscSmiley,{size:24,color:"#6D6D6D",className:"cursor-pointer",onClick:()=>{s.setDisplayEmoji(!s.displayEmoji)}})]}),(0,l.jsx)("div",{className:"flex justify-center items-center cursor-pointer p-2 rounded-full bg-blue-500",children:(0,l.jsx)(n.VscSend,{size:24,color:"#ffffff",onClick:()=>{s.sendMsg()}})})]})})]}):(0,l.jsx)(Z,{})},ef=e=>{var t,s,n,r,i,u;let{host:c,user:d,isHost:o,onClick:D}=e;return d&&c?(0,l.jsxs)("div",{className:"w-full flex gap-2 justify-between",onClick:()=>D(o,o?null:d.uid),children:[(0,l.jsx)("div",{className:"flex justify-center items-center rounded-full overflow-hidden border w-fit h-fit",children:(0,l.jsx)(a.default,{src:null!==(u=d.photoURL)&&void 0!==u?u:"/user.png",width:o?60:40,height:o?60:40,alt:"user_icon"})}),(0,l.jsxs)("div",{className:"flex-1 w-full flex flex-col justify-center truncate",children:[(0,l.jsxs)("div",{className:"flex items-center w-full ".concat(!o&&"text-xs"),children:[(0,l.jsx)("p",{className:"text-blue-500 text-base",children:d.name}),(0,l.jsxs)("p",{className:"text-sm text-gray-500 truncate",children:["#",d.tag]})]}),(0,l.jsx)("p",{className:"text-xs text-gray-500 w-full truncate",children:o?d.status_msg:null===(t=c.friends[d.uid])||void 0===t?void 0:t.latestMsg})]}),!o&&(0,l.jsxs)("div",{className:"h-full flex flex-col justify-end items-end gap-1",children:[(0,l.jsx)("p",{className:"text-xs text-gray-400",children:null===(n=c.friends[d.uid])||void 0===n?void 0:null===(s=n.lastMsgAt)||void 0===s?void 0:s.toDate().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),(null===(r=c.friends[d.uid])||void 0===r?void 0:r.unReadMsg)!==0&&(0,l.jsx)(et,{color:"red",children:null===(i=c.friends[d.uid])||void 0===i?void 0:i.unReadMsg})]})]}):(0,l.jsx)(X,{})};function eh(){let e=async()=>{await h()};return(0,l.jsxs)("div",{className:"w-screen h-screen flex flex-col justify-center items-center ",children:[(0,l.jsx)(V,{}),(0,l.jsx)("p",{className:"text-3xl mb-4 animate-fade-in-up",children:"정보를 다시 가져올게요."}),(0,l.jsx)("p",{className:"text-lg animate-fade-in-up mb-4",children:"이 화면이 계속 나오나요? 그럼 다시 로그인하세요."}),(0,l.jsx)(es,{onClick:e,children:"다시 로그인하기"})]})}function em(){return(0,l.jsxs)("div",{className:"w-full h-full flex flex-col justify-center items-center",children:[(0,l.jsx)(P,{}),(0,l.jsx)("p",{className:"text-3xl mb-4 animate-fade-in-up",children:"친구와 대화를 시작해보세요."}),(0,l.jsx)("p",{className:"text-lg animate-fade-in-up",children:"앗, 아직 친구가 없나요? 저런..."})]})}var eg=s(9726);function ej(e){let{userData:t,isLogin:s,logout:a}=e,r=function(){let[e,t]=(0,n.useState)(!1);return(0,n.useEffect)(()=>{let e=()=>{t(window.innerWidth<768)};return window.addEventListener("resize",e),e(),()=>{window.removeEventListener("resize",e)}},[]),e}(),i=t.user,u=function(e){let{user:t}=e,[s,l]=(0,n.useState)(null),[a,r]=(0,n.useState)(null),[i,u]=(0,n.useState)(null),[c,d]=(0,n.useState)(!1),[o,D]=(0,n.useState)(null),[x,f]=(0,n.useState)(!1),h=async()=>{if(!a||!i)return"닉네임과 태그를 모두 입력해주세요.";{let e=await _({uid:null==t?void 0:t.uid,target:[a,i]}),s=I(null==e?void 0:e.msg);return s.status?(D(null==e?void 0:e.target),d(!0),r(""),u(""),null):s.msg}},m=async()=>o?await L({uid:t.uid,tuid:o.uid})?f(!x):void 0:alert("일시적인 에러가 발생했답니다.");return(0,n.useEffect)(()=>{if(!t)return;let e=e=>{l(e)};(async()=>{let s=await H({uid:t.uid},e);if(console.log("fetchFriends"),s)return()=>s()})()},[t]),{friends:s,findName:a,setFindName:r,findTag:i,setFindTag:u,findModal:c,setFindModal:d,findModalHandler:()=>d(!c),targetData:o,setTargetData:D,reqSuc:x,setReqSuc:f,findHandler:h,requestHandler:m}}({user:i}),c=function(e){let{user:t}=e,[s,l]=(0,n.useState)(null),[a,r]=(0,n.useState)(!1),[i,u]=(0,n.useState)(null),[c,d]=(0,n.useState)(null),[o,D]=(0,n.useState)(null),[x,f]=(0,n.useState)(!1),[h,m]=(0,n.useState)(null),g=async()=>{u(null),d(null),D(null),await w({host:t.uid})},j=async e=>{await w({host:t.uid}),await T({uid:e}).then(e=>{u(e),D(null==e?void 0:e.friends[t.uid].chat_id)})},p=async()=>s&&""!==s?o?(await b({uid:t.uid,tuid:i.uid,chatID:o,message:s}),void l("")):alert("오잉, 일시적인 오류입니다. 다시 시도해주세요."):alert("메시지 내용을 입력해주세요."),v=()=>{f(!x)},E=async()=>{try{if(o){let e=await U({uid:t.uid,tuid:i.uid,chatID:o});e&&(m([null==e?void 0:e.name,null==e?void 0:e.tag]),v())}}catch(e){console.error("친구 요청 수락 중 오류 발생:",e)}};return(0,n.useEffect)(()=>{if(!i||!i.friends||!t)return;let e=e=>{if(!e)return;let s=null,l=null,a=null,n=e.chat.chat.map(e=>{let s=null,n=e.timestamp.toDate().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});return e.sender===t.uid?(s={...e,showTime:null===l||l!==n},l=n):(s={...e,showTime:null===a||a!==n},a=n),s}).reverse().map(e=>{var t;let l=null===(t=e.timestamp)||void 0===t?void 0:t.toDate().toLocaleDateString([],{weekday:"long",year:"numeric",month:"long",day:"numeric"}),a=(null===s||s!==l)&&!1!==e.sender;return s=l,{...e,showDate:!!a&&l}});e.chat.chat=n.reverse(),d(e.chat||null)},s=()=>{};return(async()=>{if(o){let s=await N({host:t.uid,target:i.uid,chat_id:o},e);if(console.log("fetchChat"),s)return s}return()=>{}})().then(e=>{e&&(s=e)}),()=>{s()}},[o,i,t]),{target:i,chatData:c,chatID:o,targetHandler:j,msg:s,setMsg:l,displayEmoji:a,setDisplayEmoji:r,sendMsg:p,initChat:g,inputEmoji:e=>{let{emoji:t}=e;l(e=>(e||"")+t)},acceptFriendReqModalHandler:v,acceptReqHandler:E,acceptFriendReq:x,acceptFriendReqTargetName:h}}({user:i});return s?i?r?(0,l.jsx)(eD,{userData:t,isLogin:s,logout:a,chat:c,friends:u,icon:{VscSmiley:eg.wYQ,VscSend:eg.NQj,VscUnlock:eg.WDl,VscEdit:eg.$jT,VscSearch:eg.p__,VscChevronLeft:eg.yKR}}):(0,l.jsxs)("main",{className:"w-screen h-screen m-auto p-12 bg-slate-600",children:[t.modalEditProfile?(0,l.jsx)(eu,{user:i,close:()=>{t.setModalEditProfile(!t.modalEditProfile)}}):null,(0,l.jsxs)("div",{className:"flex w-full h-full rounded-xl overflow-hidden",children:[(0,l.jsx)(ep,{user:i,friends:u,logout:a,targetHandler:e=>{null==c||c.targetHandler(e)},modalHandler:()=>{t.setModalEditProfile(!t.modalEditProfile)}}),(0,l.jsx)(eE,{user:i,chat:c})]})]}):(0,l.jsx)($,{}):(0,l.jsx)(eh,{})}let ep=e=>{var t;let{user:s,friends:n,logout:r,targetHandler:i,modalHandler:u}=e,c=async()=>{let e=await (null==n?void 0:n.findHandler());if(e)return alert(e)};return(0,l.jsxs)(l.Fragment,{children:[n.findModal&&(0,l.jsx)(ei,{targetData:n.targetData,reqSuc:n.reqSuc,requestHandler:n.requestHandler,close:n.findModalHandler,isMobile:!1}),(0,l.jsxs)("div",{className:"flex flex-col gap-4 w-3/12 h-full bg-slate-50 p-3 truncate",children:[(0,l.jsxs)("div",{className:"w-full flex justify-between items-center gap-4",children:[(0,l.jsx)("div",{className:"flex justify-center items-center rounded-full overflow-hidden border",children:(0,l.jsx)(a.default,{src:null!==(t=s.photoURL)&&void 0!==t?t:"/user.png",width:80,height:80,alt:"user_icon"})}),(0,l.jsxs)("div",{className:"flex flex-col w-full truncate",children:[(0,l.jsxs)("div",{className:"flex justify-start items-center",children:[(0,l.jsx)("p",{className:"text-lg text-blue-500 font-semibold",children:s.name}),(0,l.jsxs)("p",{className:"text-lg text-gray-500 truncate",children:["#",s.tag]})]}),(0,l.jsx)("p",{className:"text-sm text-gray-500 truncate",children:s.status_msg})]})]}),(0,l.jsxs)("div",{className:"w-full flex justify-around items-center border-b pb-4",children:[(0,l.jsx)(el,{color:"blue",onClick:u,children:(0,l.jsxs)("div",{className:"flex justify-center items-center gap-2",children:[(0,l.jsx)(eg.$jT,{size:16}),(0,l.jsx)("p",{children:"프로필 수정"})]})}),(0,l.jsx)(el,{color:"gray",onClick:()=>{r(s.uid)},children:(0,l.jsxs)("div",{className:"flex justify-center items-center gap-2",children:[(0,l.jsx)(eg.WDl,{size:16}),(0,l.jsx)("p",{children:"로그아웃"})]})})]}),(0,l.jsxs)("div",{className:"flex flex-col gap-2 border-b pb-4",children:[(0,l.jsx)("label",{className:"text-xs text-gray-600 pl-2",children:"친구 찾기"}),(0,l.jsxs)("div",{className:"flex gap-2",children:[(0,l.jsxs)("div",{className:"flex gap-2",children:[(0,l.jsx)("input",{type:"text",placeholder:"닉네임",value:n.findName||"",className:"w-full px-3 py-2 border rounded-3xl focus:outline-none focus:ring-2 focus:ring-blue-500 transition text-sm",onChange:e=>{n.setFindName(e.target.value)}}),(0,l.jsx)("input",{type:"text",placeholder:"태그",value:n.findTag||"",className:"w-full px-3 py-2 border rounded-3xl focus:outline-none focus:ring-2 focus:ring-blue-500 transition text-sm",onChange:e=>{n.setFindTag(e.target.value)}})]}),(0,l.jsx)(el,{onClick:()=>{c()},children:"검색"})]})]}),(0,l.jsx)("label",{className:"text-xs text-gray-600 pl-2",children:"친구 목록"}),(0,l.jsx)("div",{className:"w-full h-full overflow-y-scroll",children:(0,l.jsx)(ev,{user:s,friends:n,targetHandler:e=>{i(e)}})})]})]})},ev=e=>{let{user:t,friends:s,targetHandler:n}=e;return s.friends?(0,l.jsx)("div",{className:"w-full flex flex-col gap-4 overflow-y-scroll",children:s.friends.map((e,s)=>{var r,i,u,c,d;return(0,l.jsxs)("div",{className:"flex items-center gap-2 truncate cursor-pointer",onClick:()=>{n(e.uid)},children:[(0,l.jsx)("div",{className:"flex justify-center items-center rounded-full overflow-hidden border",children:(0,l.jsx)(a.default,{src:e.photoURL||"/user.png",width:60,height:60,alt:"user_icon"})}),(0,l.jsxs)("div",{className:"w-full flex flex-col truncate",children:[(0,l.jsxs)("div",{className:"flex items-center w-full",children:[(0,l.jsx)("p",{className:"text-blue-500",children:e.name}),(0,l.jsxs)("p",{className:"text-sm text-gray-500 truncate",children:["#",e.tag]})]}),(0,l.jsx)("p",{className:"text-xs text-gray-500 w-full truncate",children:null===(r=t.friends[e.uid])||void 0===r?void 0:r.latestMsg})]}),(0,l.jsxs)("div",{className:"h-full flex flex-col items-end gap-1",children:[(null===(i=t.friends[e.uid])||void 0===i?void 0:i.unReadMsg)!==0&&(0,l.jsx)(et,{children:null===(u=t.friends[e.uid])||void 0===u?void 0:u.unReadMsg}),(0,l.jsx)("p",{className:"text-xs text-gray-400",children:null===(d=t.friends[e.uid])||void 0===d?void 0:null===(c=d.lastMsgAt)||void 0===c?void 0:c.toDate().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})]},s)})}):(0,l.jsx)(X,{})},eE=e=>{let{user:t,chat:s}=e;return(0,l.jsx)("div",{className:"w-full h-full flex flex-col bg-white p-4",children:s.target?s.chatData?(0,l.jsxs)(l.Fragment,{children:[s.acceptFriendReq&&s.acceptFriendReqTargetName&&(0,l.jsx)(er,{targetName:s.acceptFriendReqTargetName,close:s.acceptFriendReqModalHandler}),(0,l.jsxs)("div",{className:"flex justify-start items-center gap-4 border-b pb-2",children:[(0,l.jsx)("div",{className:"flex justify-center items-center rounded-full overflow-hidden border",children:(0,l.jsx)(a.default,{src:s.target.photoURL||"/user.png",width:60,height:60,alt:"user_icon"})}),(0,l.jsxs)("div",{className:"w-full flex flex-col items-start",children:[(0,l.jsxs)("p",{className:"text-xl font-semibold",children:[s.target.name," "]}),(0,l.jsx)("p",{className:"text-xs text-gray-500 w-full truncate",children:s.target.status_msg})]})]}),(0,l.jsx)("div",{className:"h-full flex flex-col-reverse gap-4 overflow-y-auto py-2",children:Array.isArray(s.chatData.chat)&&s.chatData.chat.map((e,n)=>{if(!e.sender)return(0,l.jsx)(eo,{},n);var r=e.timestamp.toDate().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});return e.message&&(0,l.jsxs)("div",{children:[e.showDate&&(0,l.jsxs)("div",{className:"relative w-full flex justify-center items-center my-4",children:[(0,l.jsx)("div",{className:"absolute top-1/2 left-0 w-full border"}),(0,l.jsx)("div",{className:"text-gray-500 text-sm bg-white z-30 px-4",children:e.showDate})]}),t.uid===e.sender?(0,l.jsxs)("div",{className:"flex justify-end gap-2 items-end",children:[(0,l.jsxs)("div",{className:"flex flex-col items-end text-blue-300",children:[(0,l.jsx)("p",{className:"text-xs",children:e.read?"":"1"}),(0,l.jsx)("p",{className:"text-xs text-gray-400",children:e.showTime&&r})]}),(0,l.jsx)("p",{className:"max-w-half bg-blue-500 text-white px-4 py-2 text-sm rounded-tl-xl rounded-tr-xl rounded-bl-xl",children:e.message}),(0,l.jsx)("div",{className:"flex justify-center items-center rounded-full overflow-hidden border",children:(0,l.jsx)(a.default,{src:t.photoURL||"/user.png",width:30,height:30,alt:"user_icon"})})]}):(0,l.jsxs)("div",{className:"flex gap-2 justify-start items-end",children:[(0,l.jsx)("div",{className:"flex justify-center items-center rounded-full overflow-hidden border",children:(0,l.jsx)(a.default,{src:s.target.photoURL||"/user.png",width:30,height:30,alt:"user_icon"})}),(0,l.jsx)("p",{className:"max-w-half bg-slate-100 px-4 py-2 text-sm rounded-tr-xl rounded-tl-xl rounded-br-xl",children:e.message}),(0,l.jsx)("p",{className:"text-xs text-gray-400",children:e.showTime&&r})]})]},n)})}),!s.chatData.isAccept&&t.uid===s.chatData.target&&(0,l.jsx)(ed,{onClick:()=>s.acceptReqHandler({uuid:t.uid,tuid:s.target.uid,chatID:s.chatID})}),(0,l.jsx)("div",{className:"flex justify-center items-center pt-2 h-fit ".concat(s.chatData.isAccept?"":"pointer-events-none"),children:(0,l.jsxs)("div",{className:"w-full h-fit flex justify-between items-center gap-2 rounded-full bg-slate-100 px-4 py-2",children:[(0,l.jsx)("input",{type:"text",placeholder:s.chatData.isAccept?"채팅을 입력하세요":"친구가 되기 전에 채팅을 보낼 수 없어요.",value:s.msg||"",onChange:e=>{s.setMsg(e.target.value)},onKeyDown:e=>{"Enter"===e.key&&s.sendMsg()},className:"bg-transparent outline-none w-10/12"}),(0,l.jsxs)("div",{className:"relative flex justify-end items-center w-1/12",children:[s.displayEmoji&&(0,l.jsx)(ec,{onClick:e=>s.inputEmoji({emoji:e,setMsg:s.setMsg})}),(0,l.jsx)(eg.wYQ,{size:24,color:"#6D6D6D",className:"cursor-pointer",onClick:()=>{s.setDisplayEmoji(!s.displayEmoji)}})]}),(0,l.jsx)("div",{className:"flex justify-center items-center cursor-pointer p-2 rounded-full bg-blue-500",children:(0,l.jsx)(eg.NQj,{size:24,color:"#ffffff",onClick:()=>{s.sendMsg()}})})]})})]}):(0,l.jsx)(Z,{}):(0,l.jsx)(em,{})})};function ew(){var e;let t=M(),s=function(){let e=M(),[t,s]=(0,n.useState)(null),[l,a]=(0,n.useState)(!1);return(0,n.useEffect)(()=>{if(!e)return;let t=async e=>{s(e)};(async()=>{let e=await F(t);if(console.log("fetchUser"),e)return()=>e()})()},[e]),{user:t,modalEditProfile:l,setModalEditProfile:a}}();return(k(null===(e=s.user)||void 0===e?void 0:e.uid),t||s.user)?(0,l.jsx)(ej,{userData:s,isLogin:t,logout:R}):(0,l.jsx)(ey,{})}let ey=()=>(0,l.jsxs)("main",{className:"min-h-screen bg-gray-100 flex flex-col items-center justify-center py-12",children:[(0,l.jsx)(K,{}),(0,l.jsx)("h1",{className:"text-4xl font-bold animate-fade-in-up",children:"Chat"}),(0,l.jsx)("p",{className:"mt-2 animate-fade-in-up",children:"실시간 채팅 플랫폼"}),(0,l.jsx)("div",{className:"flex space-x-4 mt-3 animate-fade-in-up",children:(0,l.jsx)(es,{onClick:C,color:"gray",children:(0,l.jsxs)("div",{className:"flex justify-center items-center gap-4",children:[(0,l.jsx)(a.default,{src:"/google.svg",alt:"google",width:30,height:30}),(0,l.jsx)("p",{children:"Google 로그인"})]})})})]})},3140:function(e,t,s){"use strict";function l(e){let{src:t,width:s,quality:l}=e;return"https://itsjh1242.github.io/nextjs-chat/".concat(t,"?w=").concat(s,"&q=").concat(l||75)}s.r(t),s.d(t,{default:function(){return l}})}},function(e){e.O(0,[217,898,358,226,971,23,744],function(){return e(e.s=4714)}),_N_E=e.O()}]);